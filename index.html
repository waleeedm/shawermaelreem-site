<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shawarma El Reem — Working Frontend (Final)</title>
  <meta name="description" content="Shawarma El Reem — menu, cart, checkout with address, WhatsApp, branches, responsive." />
  <style>
    :root{ --accent:#f6b21a; --dark:#111; --muted:#666; --maxw:1200px; }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;color:var(--dark);background:#fafafa;-webkit-font-smoothing:antialiased}
    .container{max-width:var(--maxw);margin:0 auto;padding:18px}

    /* Header / nav */
    header{position:sticky;top:0;background:#fff;z-index:100;border-bottom:1px solid #eee;box-shadow:0 1px 6px rgba(0,0,0,0.03)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:44px;width:44px;border-radius:8px;object-fit:cover}
    nav ul{display:flex;gap:12px;list-style:none;margin:0;padding:0}
    nav a{padding:8px 10px;border-radius:6px;color:var(--dark);text-decoration:none;font-weight:600;cursor:pointer}
    nav a:hover, nav a.active{color:var(--accent)}
    .burger{display:none;background:transparent;border:0;font-size:20px;cursor:pointer}
    .order-cta{background:transparent;border:1px solid var(--accent);color:var(--accent);padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}

    /* hero */
    .hero{display:flex;gap:20px;align-items:center;padding:28px 0}
    .hero-copy{flex:1}
    .hero-media{width:420px;height:260px;border-radius:12px;overflow:hidden;cursor:pointer}
    .hero-media img{width:100%;height:100%;object-fit:cover;display:block}

    /* layout */
    main{display:grid;grid-template-columns:1fr 380px;gap:20px;padding-bottom:40px}
    .panel{background:#fff;border-radius:12px;padding:14px;border:1px solid #eee}

    /* menu */
    .menu-controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .category-tabs{display:flex;gap:8px;flex-wrap:nowrap;overflow:auto;padding-bottom:6px}
    .category-tabs::-webkit-scrollbar{height:6px}
    .category-tabs button{white-space:nowrap;cursor:pointer}
    .menu-list{display:grid;gap:10px}
    .menu-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;border:1px solid #f2f2f2;background:#fff}
    .menu-left{display:flex;align-items:center;gap:12px;min-width:0}
    .menu-img{width:90px;height:70px;border-radius:8px;overflow:hidden;flex-shrink:0;cursor:pointer}
    .menu-img img{width:100%;height:100%;object-fit:cover;display:block}
    .meta{color:var(--muted);font-size:13px;word-break:break-word}
    .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .btn.primary{background:var(--accent);font-weight:700}
    .btn.ghost{background:transparent;border:1px solid #eee}

    /* branches */
    .branches-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
    .branch{padding:10px;border-radius:10px;border:1px solid #f2f2f2;background:#fff}

    /* forms */
    input,select,textarea{padding:10px;border-radius:8px;border:1px solid #ddd;width:100%;font-size:14px}
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}

    /* cart */
    .cart-box{position:sticky;top:100px}
    .cart-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:120;padding:20px}
    .modal{background:#fff;border-radius:12px;padding:18px;max-width:720px;width:100%;max-height:90vh;overflow:auto}
    .lightbox-img{max-width:90vw;max-height:80vh;display:block}

    /* survey popup */
    .survey-btn { background:#fff; border:1px solid var(--accent); color:var(--accent); padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer; }
    .survey-popup { position:fixed; right:18px; top:110px; width:360px; max-width:calc(100% - 40px); background:#fff; border:1px solid #eee; border-left:4px solid var(--accent); border-radius:10px; padding:14px; box-shadow:0 6px 28px rgba(0,0,0,0.12); z-index:130; display:none; }
    .survey-popup h4{margin:0 0 8px 0}
    .survey-stars{font-size:22px; letter-spacing:4px; cursor:pointer; color:#ddd}
    .survey-stars .active{color:var(--accent)}
    .survey-close{position:absolute; right:8px; top:8px; cursor:pointer; font-size:16px; color:var(--muted)}

    /* floating WA */
    .floating-wa { position:fixed; bottom:22px; right:22px; width:56px; height:56px; border-radius:50%; background:#fff; border:2px solid var(--accent); display:flex; align-items:center; justify-content:center; z-index:140; box-shadow:0 6px 18px rgba(0,0,0,0.12); cursor:pointer; transition:transform .12s ease; }
    .floating-wa:hover{ transform:translateY(-3px); background:var(--accent); }
    .floating-wa svg{ width:28px; height:28px; fill:var(--accent); transition:fill .12s ease; }
    .floating-wa:hover svg{ fill:#fff; }

    footer{padding:20px 0;color:var(--muted);text-align:center}
    .social a{display:inline-block;margin:0 6px;padding:8px;border-radius:8px;background:#222;color:#fff;text-decoration:none}

    @media (max-width:980px){
      main{grid-template-columns:1fr}
      .hero-media{width:100%;height:200px}
      nav ul{display:none}
      .burger{display:block}
      .order-cta{padding:8px 10px}
      .modal{max-width:520px}
      .survey-popup{right:12px;left:12px;top:84px;width:auto}
      .menu-img{width:70px;height:56px}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand" style="align-items:center">
        <img src="assets/images/about-banner.jpg" alt="logo" />
        <div>
          <strong>Shawarma El Reem</strong>
          <div style="font-size:12px;color:var(--muted)">Clean Street Food • Since 2007</div>
        </div>
      </div>

      <nav>
        <ul id="mainNav">
          <li><a class="nav-link" data-target="#home">Home</a></li>
          <li><a class="nav-link" data-target="#menu-section">Menu</a></li>
          <li><a class="nav-link" data-target="#serving">Serving</a></li>
          <li><a class="nav-link" data-target="#branches">Branches</a></li>
          <li><a class="nav-link" data-target="#inquire">Inquire</a></li>
        </ul>
      </nav>

      <div style="display:flex;gap:10px;align-items:center">
        <!-- Take Survey button next to Open Menu (top-right) -->
        <button class="survey-btn" id="takeSurveyBtn">Take Survey</button>

        <button class="order-cta" id="orderNow">Open Menu</button>
        <button class="burger" id="burger" aria-label="Menu">☰</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div>
      <section id="home" class="hero">
        <div class="hero-copy">
          <h1>Real shawarma, quick service — taste the Reem difference.</h1>
          <p style="color:var(--muted)">Handcrafted rolls, premium spices, and clean street food across our branches. Order from our clustered menu below.</p>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn primary" id="orderInline">Open Menu</button>
            <button class="btn ghost" id="viewBranchesBtn">View Branches</button>
          </div>
        </div>
        <div class="hero-media" id="heroViewport" title="Tap to preview">
          <img src="assets/images/portfolio-banner.jpg" alt="Featured food" />
        </div>
      </section>

      <section id="menu-section" class="panel" style="margin-top:18px">
        <h2>Menu & Ordering</h2>
        <div class="menu-controls">
          <div class="category-tabs" id="categoryTabs" role="tablist" aria-label="Categories"></div>
          <input id="menuSearch" placeholder="Search menu..." />
        </div>

        <div class="menu-list" id="menuList"></div>

        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <div>Cart: <span id="cartCount">0</span> items — <strong id="cartTotal">EGP 0</strong></div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="viewCart">View Cart</button>
            <button class="btn primary" id="whatsappCheckout">Checkout via WhatsApp</button>
          </div>
        </div>
      </section>

      <section id="serving" class="panel" style="margin-top:18px">
        <h2>Serving & Delivery</h2>
        <p style="color:var(--muted)">Pickup, delivery and partners. Hotline: <strong>16068</strong></p>
        <ul style="color:var(--muted)">
          <li>Pickup & delivery from branches</li>
          <li>Delivery partners: Talabat, Otlob</li>
        </ul>
      </section>

      <section id="inquire" class="panel" style="margin-top:18px">
        <h2>Inquire — Franchise, Jobs, Contact</h2>
        <p style="color:var(--muted);margin:6px 0">Single form for all inquiries.</p>
        <form id="unifiedForm" onsubmit="event.preventDefault();submitUnified()">
          <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap">
            <select id="enquiryType">
              <option value="contact">General Contact</option>
              <option value="franchise">Franchise / Partnership</option>
              <option value="job">Job Application</option>
            </select>
            <input id="ufName" placeholder="Full name*" required />
            <input id="ufPhone" placeholder="Phone*" required />
          </div>

          <div id="franchiseFields" style="display:none;margin-bottom:8px">
            <input id="franchiseLocation" placeholder="Preferred location / city" />
            <input id="franchiseInvestment" placeholder="Investment capacity (EGP)" />
          </div>

          <div id="jobFields" style="display:none;margin-bottom:8px">
            <select id="jobPosition">
              <option>Cook</option><option>Rider</option><option>Store Manager</option>
            </select>
            <textarea id="jobCV" placeholder="Paste short CV or message"></textarea>
          </div>

          <textarea id="ufMessage" placeholder="Message (optional)" style="min-height:80px"></textarea>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn primary" type="submit">Submit</button>
            <button class="btn" type="button" id="resetUnified">Reset</button>
          </div>
        </form>
      </section>
    </div>

    <aside>
      <div class="panel" id="branches">
        <h3>Branches</h3>
        <div class="branches-grid" id="branchesGrid"></div>
        <div style="margin-top:10px;text-align:center"><button class="btn" id="showMoreBranches">Show more</button></div>
      </div>

      <div class="panel" style="margin-top:14px">
        <h3>Branch map</h3>
        <div style="height:200px">
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3443.123!2d31.2357!3d30.0444!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2sCairo!5e0!3m2!1sen!2seg!4v1690000000000" width="100%" height="200" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
        <div style="margin-top:6px;text-align:right"><a href="https://www.google.com/maps" target="_blank" style="color:var(--accent);font-size:13px">View larger map →</a></div>
      </div>

      <div class="panel cart-box" style="margin-top:14px">
        <h3>Your Cart</h3>
        <div id="cartItems" style="min-height:40px"></div>
        <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
          <div style="font-weight:700">Total: <span id="cartTotalSide">EGP 0</span></div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="emptyCart">Empty</button>
            <button class="btn primary" id="checkoutSideBtn">Checkout</button>
          </div>
        </div>
      </div>

      <div class="panel" style="margin-top:14px">
        <h3>Quick Contact</h3>
        <div style="font-size:14px;color:var(--muted)">Hotline: <strong>16068</strong><br/>Email: hello@shawarmaelreem.example</div>
        <div style="margin-top:12px"><a class="btn primary" href="#inquire">Send an inquiry</a></div>
      </div>
    </aside>
  </main>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div><strong>Shawarma El Reem</strong><br><span style="color:var(--muted)">Clean Street Food • Since 2007</span></div>
      <div class="social">
        <a href="#" id="fb">Facebook</a>
        <a href="#" id="ig">Instagram</a>
        <a href="#" id="tt">TikTok</a>
        <a href="#" id="wa">WhatsApp</a>
      </div>
      <div style="text-align:right;color:var(--muted)">© Shawarma El Reem — All rights reserved</div>
    </div>
  </footer>

  <!-- modal backdrop -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" id="modalContent"></div>
  </div>

  <!-- survey popup (right-side pop-up, hidden by default) -->
  <div class="survey-popup" id="surveyPopup" aria-hidden="true" role="dialog" aria-label="Survey">
    <div class="survey-close" id="surveyClose" title="Close">✕</div>
    <h4>Quick Survey</h4>
    <div style="margin-bottom:8px;color:var(--muted)">Tap a star to rate (1-5)</div>
    <div class="survey-stars" id="surveyStars" title="Rate 1 to 5">★★★★★</div>
    <div style="margin-top:10px;">
      <label style="font-size:13px;color:var(--muted)">What did you order?</label>
      <input id="surveyOrder" placeholder="e.g. Chicken Roll" />
    </div>
    <div style="margin-top:10px;">
      <label style="font-size:13px;color:var(--muted)">Additional comments</label>
      <textarea id="surveyComments" style="min-height:80px"></textarea>
    </div>
    <div style="margin-top:8px;"><label><input type="checkbox" id="surveyDelivery" /> Rate your delivery experience</label></div>
    <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
      <button class="btn" id="surveyCancel">Cancel</button>
      <button class="btn primary" id="surveySubmit">Submit Feedback</button>
    </div>
  </div>

  <!-- floating WhatsApp button (white circle with gold border) -->
  <div class="floating-wa" id="floatingWA" title="Chat with us on WhatsApp" aria-label="WhatsApp chat">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M20.52 3.478A11.94 11.94 0 0012.001.5C6.486.5 1.933 4.576 1.008 9.73c-.06.212-.29 1.012-.29 1.012s-.22.98-.22 2.983c0 2.29.708 4.034 1.923 5.858l-.2 3.476 3.567-.202c1.62.89 3.03 1.38 4.475 1.38 5.516 0 10.069-4.077 10.994-9.23.925-5.155-.628-10.229-5.446-11.832zM12 20.5c-1.2 0-2.397-.29-3.49-.86l-.25-.13-2.133.135.388-2.138-.16-.27A8.5 8.5 0 113.5 9.5c1.07-3.12 4.04-5.5 8.5-5.5 4.46 0 7.43 2.38 8.5 5.5.98 2.87-.07 6.56-2.92 8.81-1.78 1.54-4.05 2.15-6.37 2.15z"/><path d="M17.5 14.5c-.24 0-1.37-.34-1.87-.38-.48-.03-1.06.24-1.95.42-.82.17-2.02-.38-3.6-1.84-1.5-1.4-2.1-2.6-1.93-3.5.18-.9.78-1.18.98-1.34.2-.16.44-.18.63-.18.2 0 .39 0 .57.01.18.01.44-.06.68.52.25.58.86 1.99.94 2.14.09.15.14.33.02.53-.12.21-.18.34-.36.53-.18.2-.38.45-.17.88.21.43.93 1.51 2 2.44 1.38 1.19 2.4 1.13 2.83.98.43-.15.94-.38 1.07-.66.13-.27.13-.5.09-.55-.04-.06-.16-.09-.3-.09z"/></svg>
  </div>

  <script>
    // Full script: cart, menu, categories, branches, checkout, survey, images by category, lightbox, floating WA
    document.addEventListener('DOMContentLoaded', ()=> {
      /* ---------- Data ---------- */
      const MENU = [
        {id:1,cat:'Rolls',name:'Classic Chicken Roll',desc:'Shredded chicken, salad, garlic',price:85},
        {id:2,cat:'Rolls',name:'Classic Beef Roll',desc:'Beef shawarma, pickles',price:95},
        {id:3,cat:'Plates',name:'Kofta Platter',desc:'Grilled kofta, rice, tahini',price:110},
        {id:4,cat:'Sides',name:'Fries & Dips',desc:'Seasoned fries with dips',price:45},
        {id:5,cat:'Family',name:'Family Box (4 Rolls)',desc:'4 rolls + sides',price:320},
        {id:6,cat:'Drinks',name:'Cold Drink (Can)',desc:'Coke / Sprite',price:20},
        {id:7,cat:'Rolls',name:'Spicy Roll',desc:'Extra chili',price:90}
      ];

      const BRANCHES = [
        {title:'Downtown — Tahrir',addr:'123 Tahrir St',phone:'16068'},
        {title:'Zamalek',addr:'45 Nile View',phone:'16068'},
        {title:'Mohandessin',addr:'8 El Sheikh',phone:'16068'},
        {title:'Maadi',addr:'32 Road',phone:'16068'},
        {title:'Heliopolis',addr:'10 El Korba',phone:'16068'},
        {title:'6th of October',addr:'Shopping Mall',phone:'16068'}
      ];

      /* ---------- Elements ---------- */
      const categoryTabs = document.getElementById('categoryTabs');
      const menuList = document.getElementById('menuList');
      const menuSearch = document.getElementById('menuSearch');
      const cartCount = document.getElementById('cartCount');
      const cartTotal = document.getElementById('cartTotal');
      const cartItems = document.getElementById('cartItems');
      const cartTotalSide = document.getElementById('cartTotalSide');
      const viewCartBtn = document.getElementById('viewCart');
      const whatsappBtn = document.getElementById('whatsappCheckout');
      const emptyCartBtn = document.getElementById('emptyCart');
      const showMoreBtn = document.getElementById('showMoreBranches');
      const branchesGrid = document.getElementById('branchesGrid');
      const modalBackdrop = document.getElementById('modalBackdrop');
      const modalContent = document.getElementById('modalContent');
      const heroViewport = document.getElementById('heroViewport');
      const orderNowBtn = document.getElementById('orderNow');
      const orderInlineBtn = document.getElementById('orderInline');
      const viewBranchesBtn = document.getElementById('viewBranchesBtn');
      const burger = document.getElementById('burger');
      const checkoutSideBtn = document.getElementById('checkoutSideBtn');

      // added UI elements
      const takeSurveyBtn = document.getElementById('takeSurveyBtn');
      const surveyPopup = document.getElementById('surveyPopup');
      const surveyClose = document.getElementById('surveyClose');
      const surveyStars = document.getElementById('surveyStars');
      const surveySubmit = document.getElementById('surveySubmit');
      const surveyCancel = document.getElementById('surveyCancel');
      const surveyOrder = document.getElementById('surveyOrder');
      const surveyComments = document.getElementById('surveyComments');
      const surveyDelivery = document.getElementById('surveyDelivery');
      const floatingWA = document.getElementById('floatingWA');

      // basic safety
      if(!menuList || !categoryTabs){ console.error('Essential DOM nodes missing'); /* stop but keep page usable */ }

      /* ---------- Cart state ---------- */
      let cart = JSON.parse(localStorage.getItem('reem_cart')||'[]');
      function persist(){ localStorage.setItem('reem_cart', JSON.stringify(cart)); }
      function formatPrice(v){ return 'EGP ' + v; }

      /* ---------- Categories ---------- */
      const categories = ['All', ...Array.from(new Set(MENU.map(i=>i.cat)))];
      let activeCategory = 'All';

      function renderCategoryTabs(){
        if(!categoryTabs) return;
        categoryTabs.innerHTML = '';
        categories.forEach(cat=>{
          const b = document.createElement('button'); b.className='btn ghost'; b.textContent = cat;
          if(cat===activeCategory){ b.style.borderColor = 'var(--accent)'; b.style.background='#fff'; b.style.color='var(--accent)'; }
          b.addEventListener('click', ()=>{ activeCategory = cat; renderMenu(); renderCategoryTabs(); });
          categoryTabs.appendChild(b);
        });
      }

      /* ---------- Images by category (mapping) ---------- */
      // Use the renamed files menu1.jpg, menu2.jpg, menu3.jpg in /assets/images/
      function getImageByCategory(cat){
        if(cat==='Rolls') return 'assets/images/menu1.jpg';
        if(cat==='Plates' || cat==='Sides') return 'assets/images/menu2.jpg';
        return 'assets/images/menu3.jpg';
      }

      /* ---------- Render Menu (with thumbnails left, clickable to open lightbox) ---------- */
      function renderMenu(){
        if(!menuList) return;
        const q = (menuSearch && menuSearch.value || '').trim().toLowerCase();
        menuList.innerHTML = '';
        const filtered = MENU.filter(it=>{
          if(activeCategory!=='All' && it.cat!==activeCategory) return false;
          if(q && !(it.name.toLowerCase().includes(q) || it.desc.toLowerCase().includes(q))) return false;
          return true;
        });
        if(filtered.length===0){ menuList.innerHTML = '<div style="color:var(--muted)">No items found.</div>'; return; }
        filtered.forEach(it=>{
          const imgSrc = getImageByCategory(it.cat);
          const el = document.createElement('div'); el.className = 'menu-item';
          el.innerHTML = `
            <div class="menu-left">
              <div class="menu-img" tabindex="0" role="button" aria-label="View ${it.name} image"><img src="${imgSrc}" alt="${it.name}"></div>
              <div style="min-width:0">
                <strong>${it.name}</strong>
                <div class="meta">${it.desc}</div>
                <div style="font-size:12px;color:var(--muted)">Category: ${it.cat}</div>
              </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
              <div style="font-weight:700">${formatPrice(it.price)}</div>
              <div style="display:flex;gap:6px">
                <button class="btn" data-add="${it.id}">Add</button>
                <button class="btn ghost" data-view="${it.id}">View</button>
              </div>
            </div>
          `;
          // add behavior
          const addBtn = el.querySelector('[data-add]');
          const viewBtn = el.querySelector('[data-view]');
          const imgWrap = el.querySelector('.menu-img');
          addBtn && addBtn.addEventListener('click', ()=> addToCart(it.id));
          viewBtn && viewBtn.addEventListener('click', ()=> openModal(`<img src="${imgSrc}" class="lightbox-img" alt="${it.name}"/><h3>${it.name}</h3><p>${it.desc}</p><p style="font-weight:700">${formatPrice(it.price)}</p>`));
          imgWrap && imgWrap.addEventListener('click', ()=> openModal(`<img src="${imgSrc}" class="lightbox-img" alt="${it.name}"/>`));
          menuList.appendChild(el);
        });
      }
      menuSearch && menuSearch.addEventListener('input', renderMenu);

      /* ---------- Cart UI ---------- */
      function updateCartUI(){
        if(cartCount) cartCount.textContent = cart.length;
        const total = cart.reduce((s,i)=>s+i.price,0);
        if(cartTotal) cartTotal.textContent = 'EGP ' + total;
        if(cartTotalSide) cartTotalSide.textContent = 'EGP ' + total;
        if(cartItems){
          cartItems.innerHTML = '';
          if(cart.length===0){ cartItems.innerHTML = '<div style="color:var(--muted)">Cart is empty</div>'; persist(); return; }
          cart.forEach((c,idx)=>{
            const d = document.createElement('div'); d.className='cart-item';
            d.innerHTML = `<div>${c.name} <small style="color:var(--muted)">x1</small></div>
              <div style="text-align:right">${formatPrice(c.price)}<br/><button class="btn" data-r="${idx}">Remove</button></div>`;
            d.querySelector('[data-r]').addEventListener('click', ()=> { removeFromCart(idx); });
            cartItems.appendChild(d);
          });
          persist();
        }
      }
      function addToCart(id){ const item = MENU.find(m=>m.id===id); if(!item) return; cart.push(item); updateCartUI(); }
      function removeFromCart(i){ cart.splice(i,1); updateCartUI(); }
      emptyCartBtn && emptyCartBtn.addEventListener('click', ()=> { cart = []; updateCartUI(); });

      /* ---------- Modal helpers ---------- */
      function openModal(html){ if(!modalBackdrop || !modalContent) return; modalContent.innerHTML = html || ''; modalBackdrop.style.display = 'flex'; modalBackdrop.setAttribute('aria-hidden','false'); }
      function closeModal(){ if(!modalBackdrop) return; modalBackdrop.style.display = 'none'; modalBackdrop.setAttribute('aria-hidden','true'); }
      modalBackdrop && modalBackdrop.addEventListener('click', (e)=> { if(e.target===modalBackdrop) closeModal(); });

      /* ---------- View Cart + Checkout flow ---------- */
      viewCartBtn && viewCartBtn.addEventListener('click', ()=> {
        if(cart.length===0){ alert('Cart is empty'); return; }
        const list = cart.map((c, i)=>`<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f1f1f1">
          <div>${c.name}</div><div>EGP ${c.price} <button data-remove="${i}">remove</button></div></div>`).join('');
        openModal(`<h3>Your Cart</h3>${list}<div style="margin-top:12px;font-weight:700">Total: EGP ${cart.reduce((s,i)=>s+i.price,0)}</div>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn primary" id="modalCheckout">Checkout</button>
            <button class="btn" id="closeModal">Close</button>
          </div>`);
        setTimeout(()=> {
          document.querySelectorAll('[data-remove]').forEach(btn=> btn.addEventListener('click', ()=> { removeFromCart(parseInt(btn.getAttribute('data-remove'))); viewCartBtn.click(); }));
          const close = document.getElementById('closeModal'); if(close) close.addEventListener('click', closeModal);
          const modalCheckout = document.getElementById('modalCheckout'); if(modalCheckout) modalCheckout.addEventListener('click', openCheckoutModal);
        },20);
      });

      /* ---------- build order lines (dedupe) ---------- */
      function buildOrderLines(){
        const counts = {};
        cart.forEach(item => { counts[item.name] = (counts[item.name] || 0) + 1; });
        const seen = new Set();
        const lines = [];
        cart.forEach(item=>{
          if(seen.has(item.name)) return;
          seen.add(item.name);
          lines.push(`${counts[item.name]}x ${item.name} - EGP ${item.price}`);
        });
        return lines;
      }

      /* ---------- Checkout modal (collect info & option to WhatsApp) ---------- */
      function openCheckoutModal(){
        if(cart.length===0){ alert('Cart is empty'); return; }
        const total = cart.reduce((s,i)=>s+i.price,0);
        const linesPreview = buildOrderLines().map(l=>`<div style="font-size:14px">${l}</div>`).join('');
        openModal(`<h3>Checkout</h3>
          <form id="checkoutForm">
            <label>Name*</label><input id="coName" required />
            <label>Phone*</label><input id="coPhone" required />
            <label>Order Type</label>
            <select id="coType"><option value="Delivery">Delivery</option><option value="Pickup">Pickup</option></select>
            <div id="addressWrap" style="display:block;margin-top:8px">
              <label>Address</label><input id="coAddress" placeholder="Street, building, area" />
            </div>
            <div style="margin-top:12px"><strong>Items:</strong>${linesPreview}</div>
            <div style="margin-top:12px;font-weight:700">Total: EGP ${total}</div>
            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" class="btn primary" id="confirmCheckout">Confirm Order</button>
              <button type="button" class="btn" id="sendWhatsApp">Send to WhatsApp</button>
              <button type="button" class="btn" id="cancelCheckout">Cancel</button>
            </div>
          </form>`);
        setTimeout(()=>{
          const type = document.getElementById('coType');
          const addressWrap = document.getElementById('addressWrap');
          type && type.addEventListener('change', ()=> { addressWrap.style.display = (type.value === 'Delivery') ? 'block' : 'none'; });
          document.getElementById('cancelCheckout').addEventListener('click', closeModal);

          // Confirm Order -> show thank you modal
          document.getElementById('confirmCheckout').addEventListener('click', ()=>{
            const name = (document.getElementById('coName')||{}).value||'';
            const phone = (document.getElementById('coPhone')||{}).value||'';
            if(!name || !phone){ alert('Name and phone are required'); return; }
            closeModal();
            openModal(`<h3>Thank you!</h3><p>Your order has been received (demo). We will contact you shortly.</p><div style="margin-top:12px"><button class="btn primary" id="closeThank">OK</button></div>`);
            setTimeout(()=>{ const c = document.getElementById('closeThank'); if(c) c.addEventListener('click', ()=>{ closeModal(); cart = []; updateCartUI(); }); },20);
          });

          // Send to WhatsApp -> built message
          document.getElementById('sendWhatsApp').addEventListener('click', ()=>{
            const name = (document.getElementById('coName')||{}).value||'';
            const phone = (document.getElementById('coPhone')||{}).value||'';
            const typeVal = (document.getElementById('coType')||{}).value||'Pickup';
            const address = (document.getElementById('coAddress')||{}).value||'';
            if(!name || !phone){ alert('Name and phone are required'); return; }
            const lines = buildOrderLines();
            const total = cart.reduce((s,i)=>s+i.price,0);
            let message = 'Order from Shawarma El Reem\n';
            message += 'Items:\n' + lines.join('\n') + '\n';
            message += 'Total: EGP ' + total + '\n';
            message += 'Name: ' + name + '\n';
            message += 'Phone: ' + phone + '\n';
            message += 'Type: ' + typeVal + '\n';
            if(typeVal === 'Delivery') message += 'Address: ' + address + '\n';
            // open WhatsApp - replace number with actual business number if needed
            const url = 'https://wa.me/' + '201606800000'.replace(/\D/g,'') + '?text=' + encodeURIComponent(message);
            closeModal();
            window.open(url, '_blank');
          });
        },20);
      }

      // wire checkout actions
      whatsappBtn && whatsappBtn.addEventListener('click', openCheckoutModal); // top button
      checkoutSideBtn && checkoutSideBtn.addEventListener('click', openCheckoutModal); // sidebar checkout

      /* ---------- Branches ---------- */
      let branchesShown = 3;
      function renderBranches(){
        if(!branchesGrid) return;
        branchesGrid.innerHTML = '';
        BRANCHES.slice(0,branchesShown).forEach(b=>{
          const div = document.createElement('div'); div.className='branch';
          div.innerHTML = `<strong>${b.title}</strong><div style="color:var(--muted)">${b.addr}</div><div style="margin-top:6px;font-size:13px;color:var(--muted)">Hotline: ${b.phone}</div>`;
          branchesGrid.appendChild(div);
        });
        showMoreBtn && (showMoreBtn.textContent = branchesShown < BRANCHES.length ? 'Show more' : 'Show less');
      }
      showMoreBtn && showMoreBtn.addEventListener('click', ()=> { branchesShown = branchesShown < BRANCHES.length ? BRANCHES.length : 3; renderBranches(); });

      /* ---------- Inquiry form ---------- */
      const enquiryType = document.getElementById('enquiryType');
      const ufForm = document.getElementById('unifiedForm');
      const franchiseFields = document.getElementById('franchiseFields');
      const jobFields = document.getElementById('jobFields');
      function handleEnquiry() {
        if(!enquiryType) return;
        franchiseFields && (franchiseFields.style.display = enquiryType.value==='franchise' ? 'block' : 'none');
        jobFields && (jobFields.style.display = enquiryType.value==='job' ? 'block' : 'none');
      }
      enquiryType && enquiryType.addEventListener('change', handleEnquiry);
      const resetUnified = document.getElementById('resetUnified');
      resetUnified && resetUnified.addEventListener('click', ()=> { ufForm.reset(); handleEnquiry(); });
      window.submitUnified = function(){
        const name = (document.getElementById('ufName')||{}).value || '';
        const phone = (document.getElementById('ufPhone')||{}).value || '';
        if(!name||!phone){ alert('Name and phone required'); return; }
        const type = enquiryType.value;
        const details = { type, name, phone, message: (document.getElementById('ufMessage')||{}).value || '' };
        if(type==='franchise'){ details.location = (document.getElementById('franchiseLocation')||{}).value || ''; details.investment = (document.getElementById('franchiseInvestment')||{}).value || ''; }
        if(type==='job'){ details.position = (document.getElementById('jobPosition')||{}).value || ''; details.cv = (document.getElementById('jobCV')||{}).value || ''; }
        openModal(`<h3>Inquiry preview</h3><pre style="white-space:pre-wrap">${JSON.stringify(details,null,2)}</pre><div style="margin-top:12px"><button class="btn primary" id="confirmInquiry">Confirm</button> <button class="btn" id="cancelInquiry">Cancel</button></div>`);
        setTimeout(()=>{ const c = document.getElementById('confirmInquiry'); if(c) c.addEventListener('click', ()=> { closeModal(); alert('Form would be sent to backend (demo)'); ufForm.reset(); handleEnquiry(); }); const x = document.getElementById('cancelInquiry'); if(x) x.addEventListener('click', closeModal); },50);
      };

      /* ---------- Hero preview ---------- */
      heroViewport && heroViewport.addEventListener('click', ()=> openModal(`<img src="assets/images/portfolio-banner.jpg" class="lightbox-img" alt="Hero"/>`));

      /* ---------- Smooth scroll & nav active state ---------- */
      function smoothScrollTo(selector){
        const el = document.querySelector(selector);
        if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
      }
      document.querySelectorAll('.nav-link').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          const target = a.getAttribute('data-target');
          smoothScrollTo(target);
          document.querySelectorAll('.nav-link').forEach(x=>x.classList.remove('active'));
          a.classList.add('active');
          // close mobile nav if open
          const nav = document.querySelector('nav ul'); if(window.innerWidth<=980 && nav) nav.style.display='none';
        });
      });

      // hero quick buttons
      orderNowBtn && orderNowBtn.addEventListener('click', ()=> smoothScrollTo('#menu-section'));
      orderInlineBtn && orderInlineBtn.addEventListener('click', ()=> smoothScrollTo('#menu-section'));
      viewBranchesBtn && viewBranchesBtn.addEventListener('click', ()=> smoothScrollTo('#branches'));

      /* ---------- Mobile burger ---------- */
      if(burger){
        burger.addEventListener('click', ()=> {
          const nav = document.querySelector('nav ul');
          if(!nav) return;
          nav.style.display = nav.style.display === 'flex' ? 'none' : 'flex';
          nav.style.flexDirection = 'column';
        });
      }

      /* ---------- Survey popup behavior (opened from top-right Take Survey button) ---------- */
      let currentRating = 0;
      function setStars(r){
        currentRating = r;
        if(!surveyStars) return;
        const starsHtml = Array.from({length:5}).map((_,i)=> i < r ? '<span class="active">★</span>' : '<span>★</span>').join('');
        surveyStars.innerHTML = starsHtml;
      }
      setStars(0);

      takeSurveyBtn && takeSurveyBtn.addEventListener('click', ()=>{
        // scroll to bottom so user sees page bottom then popup
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        setTimeout(()=> {
          if(surveyPopup){ surveyPopup.style.display = 'block'; surveyPopup.setAttribute('aria-hidden','false'); }
        }, 550);
      });

      // star click detection
      surveyStars && surveyStars.addEventListener('click',(e)=>{
        const rect = surveyStars.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const width = rect.width;
        const pct = clickX / width;
        const r = Math.min(5, Math.max(1, Math.ceil(pct * 5)));
        setStars(r);
      });

      surveyClose && (surveyClose.onclick = ()=> { if(surveyPopup){ surveyPopup.style.display='none'; surveyPopup.setAttribute('aria-hidden','true'); } });
      surveyCancel && (surveyCancel.onclick = ()=> { if(surveyPopup){ surveyPopup.style.display='none'; surveyPopup.setAttribute('aria-hidden','true'); } });

      surveySubmit && surveySubmit.addEventListener('click', ()=>{
        const sOrder = surveyOrder ? surveyOrder.value : '';
        const sComments = surveyComments ? surveyComments.value : '';
        const sDelivery = surveyDelivery ? surveyDelivery.checked : false;
        if(currentRating === 0 && !sComments){
          alert('Please provide a star rating or leave a comment.');
          return;
        }
        // show thank you modal
        if(surveyPopup){ surveyPopup.style.display='none'; surveyPopup.setAttribute('aria-hidden','true'); }
        openModal(`<h3>Thanks for your feedback!</h3><p>Rating: ${currentRating || 'N/A'}</p><p>${sDelivery ? 'You rated delivery experience.' : ''}</p><div style="margin-top:12px"><button class="btn primary" id="closeSurveyThank">OK</button></div>`);
        setTimeout(()=> {
          const closeBtn = document.getElementById('closeSurveyThank');
          if(closeBtn) closeBtn.addEventListener('click', ()=> { closeModal(); });
        },20);
        // reset fields
        setStars(0);
        if(surveyOrder) surveyOrder.value='';
        if(surveyComments) surveyComments.value='';
        if(surveyDelivery) surveyDelivery.checked=false;
      });

      /* ---------- Floating WhatsApp button ---------- */
      const waEl = document.getElementById('floatingWA');
      waEl && waEl.addEventListener('click', ()=> {
        window.open('https://wa.me/201606800000', '_blank');
      });

      /* ---------- Initial render ---------- */
      renderCategoryTabs();
      renderMenu();
      renderBranches();
      updateCartUI();

      // Expose for debugging
      window._cart = cart;
      window.openCheckoutModal = openCheckoutModal;
    }); // DOMContentLoaded end
  </script>
</body>
</html>
